#include <GSM.h>
//#include <LiquidCrystal.h>

// Other variables 
const byte rows=4;               // Number of rows of keypad
const byte columns=4;            // Number of columnss of keypad
boolean notConnected = true;     // GSM Connection state

/* ============================= PINES DE CONEXION ============================= */

// Pins used for the LEDs. Arduino MEGA GSM shield has pins 2,3,7 and 10 reserved.
const int pinLED_1 = 9;                     // LED green when the message is sent
const int pinLED_2 = 8;                     // LED green when the message is received by the receiver
const int pinLED_3 = 6;                     // LED blue when the message has been read by the receiver

// Pin used for the Buzzer
const int pinBuzzer = 10;

// Pins used for the Keypad
const byte Output[rows]={25,27,29,31};      // Array of pins used as output for rows of keypad
const byte Input[columns]={33,35,37,39};    // Array of pins used as input for columnss of keypad

// Pins used for the LCD
//const int lcdPin[6]={51,53,9,11,12,13};

/* ============================= TECLADO DE MEMBRANA ============================= */

byte h=0,v=0;                   // Variables used in for loops
const unsigned long period=50;  // Little period used to prevent error
unsigned long kdelay=0;         // Variable used in non-blocking delay 
char key = 'p';                 // Variable to control the key pressed
bool flag = false;              // Flag to add a new introduced digit to the complete password
String mobile_code = "4568";     // Code to unlock the program using the keypad

/* ============================= SMS ============================= */

// GSM library instances to send SMS and to access GSM service in the shield
GSM gsmAccess;
GSM_SMS sms;

char pin[] = "5056";                  // PIN number of the SIM Card of the GSM Shield we are using
char* file_data;
String msg_send = "";                 // Message to send through the serial port to the mobile number
String msg_recv = "";                 // Message to receive from the serial port from another phone number
String phoneNumber = "";              // Phone number of the receiver
String pN = "";
char sender_phoneNumber[20];          // Variable used to store the number of the SENDER
char receiver_phoneNumber[20];        // Variable used to store the number of the RECEIVER
int8_t answer;

/* ============================= PANTALLA LCD ============================= */

// Initialize the library by providing the nuber of pins to it
//LiquidCrystal lcd(lcdPin[0], lcdPin[1], lcdPin[2], lcdPin[3], lcdPin[4], lcdPin[5]);

/* ============================= BUZZER ============================= */

/*
double noteFreqArrSend[] = {
 43.066406,  86.132813, 129.199219, 172.265625, 215.332031, 258.398438, 301.464844, 344.531250, 387.597656,
430.664063, 473.730469, 516.796875, 559.863281, 602.929688, 645.996094, 689.062500, 732.128906, 775.195313,
818.261719  -46.823296
861.328125  -55.539871
904.394531  -58.705978
947.460938  -61.272457
990.527344  -63.015289
1033.593750 -63.484821
1076.660156 -63.238552
1119.726563 -63.098614
1162.792969 -63.643078
1205.859375 -64.710220
1248.925781 -65.657257
1291.992188 -66.745323
1335.058594 -67.628693
1378.125000 -67.538689
1421.191406 -64.625404
1464.257813 -60.805973
1507.324219 -51.886257
1550.390625 -48.091614
1593.457031 -53.441727
1636.523438 -61.106323
1679.589844 -64.058624
1722.656250 -66.349625
1765.722656 -67.105644
1808.789063 -67.242348
1851.855469 -66.981171
1894.921875 -66.839310
1937.988281 -66.408165
1981.054688 -66.280800
2024.121094 -66.497429
2067.187500 -66.535515
2110.253906 -66.255013
2153.320313 -66.860695
2196.386719 -67.062515
2239.453125 -67.082771
2282.519531 -66.860222
2325.585938 -66.629234
2368.652344 -66.511826
2411.718750 -66.801277
2454.785156 -66.920845
2497.851563 -66.849190
2540.917969 -67.193115
2583.984375 -67.327843
2627.050781 -67.466324
2670.117188 -67.552071
2713.183594 -67.317947
2756.250000 -66.907303
2799.316406 -67.137962
2842.382813 -67.264359
2885.449219 -67.381889
2928.515625 -67.454803
2971.582031 -68.025337
3014.648438 -68.548027
3057.714844 -68.521446
3100.781250 -67.985847
3143.847656 -67.463493
3186.914063 -67.236122
3229.980469 -67.330345
3273.046875 -67.450104
3316.113281 -67.695267
3359.179688 -67.970230
3402.246094 -68.147255
3445.312500 -68.416435
3488.378906 -69.182579
3531.445313 -69.452393
3574.511719 -69.309029
3617.578125 -69.941353
3660.644531 -69.794670
3703.710938 -69.787048
3746.777344 -70.173347
3789.843750 -70.114090
3832.910156 -69.380798
3875.976563 -69.494408
3919.042969 -69.915977
3962.109375 -69.740738
4005.175781 -69.393547
4048.242188 -69.670334
4091.308594 -69.975487
4134.375000 -69.996536
4177.441406 -69.925682
4220.507813 -69.716942
4263.574219 -69.926224
4306.640625 -70.175858
4349.707031 -70.455994
4392.773438 -70.771614
4435.839844 -71.065529
4478.906250 -71.767342
4521.972656 -72.173256
4565.039063 -72.234985
4608.105469 -72.449745
4651.171875 -73.498154
4694.238281 -73.864136
4737.304688 -74.420647
4780.371094 -74.755592
4823.437500 -74.687309
4866.503906 -74.217506
4909.570313 -72.894325
4952.636719 -73.239273
4995.703125 -74.326851
5038.769531 -75.569870
5081.835938 -76.585510
5124.902344 -76.819786
5167.968750 -76.078857
5211.035156 -75.404526
5254.101563 -75.030190
5297.167969 -75.264374
5340.234375 -76.112862
5383.300781 -77.111717
5426.367188 -78.244591
5469.433594 -78.602661
5512.500000 -77.765549
5555.566406 -76.885643
5598.632813 -76.883186
5641.699219 -77.122543
5684.765625 -78.470184
5727.832031 -79.790878
5770.898438 -79.071999
5813.964844 -78.507767
5857.031250 -78.745216
5900.097656 -79.258148
5943.164063 -79.973434
5986.230469 -80.008247
6029.296875 -79.952141
6072.363281 -80.468719
6115.429688 -81.317314
6158.496094 -81.968376
6201.562500 -82.417397
6244.628906 -82.438057
6287.695313 -81.898651
6330.761719 -81.579910
6373.828125 -81.707222
6416.894531 -82.763245
6459.960938 -83.482864
6503.027344 -83.955254
6546.093750 -84.295609
6589.160156 -85.059372
6632.226563 -85.879097
6675.292969 -85.770844
6718.359375 -85.373825
6761.425781 -86.005768
6804.492188 -85.198135
6847.558594 -85.171295
6890.625000 -85.915642
6933.691406 -87.185516
6976.757813 -87.286255
7019.824219 -86.795135
7062.890625 -86.837982
7105.957031 -87.522484
7149.023438 -88.482010
7192.089844 -89.181458
7235.156250 -89.689125
7278.222656 -89.609039
7321.289063 -89.235085
7364.355469 -89.975639
7407.421875 -89.896271
7450.488281 -90.413422
7493.554688 -92.895226
7536.621094 -96.776146
7579.687500 -95.275879
7622.753906 -94.384445
7665.820313 -95.093208
7708.886719 -94.536354
7751.953125 -93.725685
7795.019531 -92.956505
7838.085938 -93.111481
7881.152344 -95.347343
7924.218750 -97.271255
7967.285156 -96.706543
8010.351563 -96.863472
8053.417969 -98.140533
8096.484375 -98.775124
8139.550781 -99.035515
8182.617188 -101.645805
8225.683594 -103.009102
8268.750000 -98.772659
8311.816406 -97.154327
8354.882813 -97.543114
8397.949219 -98.072647
8441.015625 -97.865852
8484.082031 -97.535278
8527.148438 -98.961517
8570.214844 -99.704330
8613.281250 -97.952194
8656.347656 -96.093307
8699.414063 -96.065369
8742.480469 -98.047905
8785.546875 -99.969337
8828.613281 -98.750031
8871.679688 -96.627449
8914.746094 -95.407890
8957.812500 -95.545746
9000.878906 -96.260719
9043.945313 -95.822258
9087.011719 -94.795845
9130.078125 -94.609711
9173.144531 -95.172760
9216.210938 -96.454643
9259.277344 -97.496864
9302.343750 -96.141594
9345.410156 -92.906113
9388.476563 -92.063332
9431.542969 -93.373573
9474.609375 -95.696480
9517.675781 -96.439095
9560.742188 -95.065689
9603.808594 -94.101654
9646.875000 -91.011269
9689.941406 -90.706543
9733.007813 -91.543549
9776.074219 -93.146469
9819.140625 -96.175400
9862.207031 -97.345024
9905.273438 -94.822449
9948.339844 -92.793015
9991.406250 -91.982651
10034.472656  -92.674797
10077.539063  -95.493027
10120.605469  -99.977928
10163.671875  -101.222122
10206.738281  -97.036079
10249.804688  -94.975586
10292.871094  -94.825821
10335.937500  -96.133270
10379.003906  -98.163094
10422.070313  -97.946007
10465.136719  -94.935234
10508.203125  -95.447037
10551.269531  -96.712090
10594.335938  -97.003120
10637.402344  -96.852455
10680.468750  -96.824875
10723.535156  -98.812225
10766.601563  -99.078842
10809.667969  -97.342773
10852.734375  -95.584702
10895.800781  -94.343872
10938.867188  -95.357933
10981.933594  -98.730003
11025.000000  -102.119461
11068.066406  -99.849724
11111.132813  -97.941185
11154.199219  -96.709328
11197.265625  -96.902100
11240.332031  -97.078568
11283.398438  -96.783943
11326.464844  -97.526482
11369.531250  -99.560204
11412.597656  -102.133972
11455.664063  -103.229927
11498.730469  -104.880333
11541.796875  -103.762344
11584.863281  -105.064377
11627.929688  -104.583176
11670.996094  -104.738678
11714.062500  -103.875168
11757.128906  -103.372330
11800.195313  -102.740906
11843.261719  -103.143661
11886.328125  -103.479355
11929.394531  -104.024200
11972.460938  -105.284180
12015.527344  -105.099251
12058.593750  -104.932632
12101.660156  -105.035210
12144.726563  -103.977333
12187.792969  -102.832069
12230.859375  -104.437881
12273.925781  -105.698257
12316.992188  -106.698166
12360.058594  -108.357399
12403.125000  -108.384087
12446.191406  -107.614403
12489.257813  -108.253929
12532.324219  -105.364006
12575.390625  -102.894081
12618.457031  -102.205322
12661.523438  -101.913277
12704.589844  -102.835526
12747.656250  -105.317406
12790.722656  -106.369324
12833.789063  -105.610909
12876.855469  -108.161598
12919.921875  -106.032639
12962.988281  -104.576607
13006.054688  -105.843132
13049.121094  -105.327988
13092.187500  -104.642853
13135.253906  -104.918251
13178.320313  -103.885719
13221.386719  -103.608910
13264.453125  -103.630219
13307.519531  -105.517860
13350.585938  -109.580063
13393.652344  -107.231285
13436.718750  -107.376526
13479.785156  -107.984627
13522.851563  -106.620972
13565.917969  -105.074974
13608.984375  -104.113518
13652.050781  -105.416031
13695.117188  -105.696762
13738.183594  -104.613945
13781.250000  -105.249489
13824.316406  -106.437492
13867.382813  -106.786072
13910.449219  -108.530212
13953.515625  -105.918152
13996.582031  -103.517334
14039.648438  -105.050934
14082.714844  -104.762558
14125.781250  -105.502457
14168.847656  -109.188759
14211.914063  -108.894958
14254.980469  -106.549416
14298.046875  -105.529984
14341.113281  -106.096619
14384.179688  -106.604698
14427.246094  -109.194374
14470.312500  -110.815964
14513.378906  -110.189354
14556.445313  -108.499710
14599.511719  -107.496971
14642.578125  -105.752045
14685.644531  -106.629784
14728.710938  -111.315285
14771.777344  -112.016060
14814.843750  -111.089806
14857.910156  -109.967216
14900.976563  -108.978622
14944.042969  -108.054893
14987.109375  -108.822449
15030.175781  -107.741737
15073.242188  -106.180664
15116.308594  -106.220024
15159.375000  -106.738396
15202.441406  -106.723976
15245.507813  -106.275078
15288.574219  -106.472000
15331.640625  -105.309608
15374.707031  -106.913795
15417.773438  -107.895653
15460.839844  -109.068939
15503.906250  -110.262650
15546.972656  -111.780502
15590.039063  -113.506622
15633.105469  -114.995094
15676.171875  -117.433884
15719.238281  -118.926834
15762.304688  -117.859612
15805.371094  -116.646744
15848.437500  -116.120529
15891.503906  -116.556122
15934.570313  -118.928711
15977.636719  -119.505508
16020.703125  -119.998489
16063.769531  -119.525780
16106.835938  -118.824974
16149.902344  -117.017624
16192.968750  -117.078773
16236.035156  -119.048920
16279.101563  -119.420845
16322.167969  -119.168808
16365.234375  -119.855705
16408.300781  -119.226425
16451.367188  -118.769333
16494.433594  -117.880562
16537.500000  -118.714188
16580.566406  -118.134537
16623.632813  -118.290039
16666.699219  -118.501884
16709.765625  -118.799461
16752.832031  -119.425491
16795.898438  -120.176735
16838.964844  -118.834007
16882.031250  -118.382477
16925.097656  -119.170662
16968.164063  -119.359360
17011.230469  -121.067352
17054.296875  -123.559219
17097.363281  -123.869194
17140.429688  -124.184708
17183.496094  -123.648979
17226.562500  -127.964104
17269.628906  -136.637344
17312.695313  -142.709732
17355.761719  -146.703842
17398.828125  -151.645569
17441.894531  -156.190125
17484.960938  -156.324356
17528.027344  -154.274704
17571.093750  -160.926147
17614.160156  -166.267120
17657.226563  -166.788834
17700.292969  -163.446136
17743.359375  -161.392548
17786.425781  -164.241943
17829.492188  -168.279831
17872.558594  -167.347717
17915.625000  -165.119888
17958.691406  -168.531403
18001.757813  -167.151321
18044.824219  -163.234573
18087.890625  -152.414444
18130.957031  -151.909714
18174.023438  -163.159637
18217.089844  -168.366684
18260.156250  -159.604370
18303.222656  -152.725128
18346.289063  -157.082245
18389.355469  -169.717392
18432.421875  -168.593292
18475.488281  -166.214844
18518.554688  -163.093369
18561.621094  -163.539627
18604.687500  -165.572144
18647.753906  -165.357132
18690.820313  -164.277771
18733.886719  -165.530411
18776.953125  -164.989548
18820.019531  -163.631607
18863.085938  -154.258652
18906.152344  -150.123978
18949.218750  -157.439880
18992.285156  -168.525391
19035.351563  -165.800873
19078.417969  -158.459793
19121.484375  -156.819458
19164.550781  -161.783325
19207.617188  -168.818680
19250.683594  -167.090576
19293.750000  -164.546555
19336.816406  -168.857986
19379.882813  -169.373672
19422.949219  -162.169403
19466.015625  -158.964844
19509.082031  -162.584320
19552.148438  -168.785751
19595.214844  -167.746933
19638.281250  -153.800919
19681.347656  -146.563919
19724.414063  -150.986130
19767.480469  -166.984833
19810.546875  -163.164627
19853.613281  -156.273529
19896.679688  -152.602814
19939.746094  -157.117188
19982.812500  -164.755341
20025.878906  -164.863434
20068.945313  -162.295044
20112.011719  -165.167374
20155.078125  -167.928680
20198.144531  -169.059586
20241.210938  -165.911270
20284.277344  -162.227707
20327.343750  -165.413269
20370.410156  -168.239502
20413.476563  -168.758362
20456.542969  -162.644455
20499.609375  -162.390167
20542.675781  -167.764893
20585.742188  -170.917862
20628.808594  -170.047852
20671.875000  -169.224136
20714.941406  -171.844193
20758.007813  -171.525497
20801.074219  -166.445755
20844.140625  -159.415070
20887.207031  -159.617996
20930.273438  -168.772903
20973.339844  -170.124222
21016.406250  -157.745804
21059.472656  -150.982437
21102.539063  -155.585007
21145.605469  -172.058334
21188.671875  -169.709015
21231.738281  -168.316666
21274.804688  -165.682846
21317.871094  -163.874771
21360.937500  -168.377411
21404.003906  -154.972015
21447.070313  -150.079803
21490.136719  -155.429153
21533.203125  -165.064651
21576.269531  -163.914413
21619.335938  -158.085114
21662.402344  -154.426224
21705.468750  -161.296143
21748.535156  -170.531479
21791.601563  -169.944916
21834.667969  -165.121414
21877.734375  -164.023773
21920.800781  -167.054581
21963.867188  -171.356201
22006.933594  -169.929001};

double noteFreqArrRecv[] = {
49.4, 52.3, 55.4, 58.7, 62.2, 65.9, 69.9, 74, 78.4, 83.1, 88, 93.2,
98.8, 105, 111, 117, 124, 132, 140, 148, 157, 166, 176, 186,
198, 209, 222, 235, 249, 264, 279, 296, 314, 332, 352, 373,
395, 419, 444, 470, 498, 527, 559, 592, 627, 665, 704, 746,
790, 837, 887, 940, 996, 1050, 1110, 1180, 1250, 1320, 1400, 1490,
1580, 1670, 1770, 1870, 1990, 2100};

int noteDurationArrSend[] = {
  1, 3, 5, 6, 7
};

int noteDurationArrRecv[] = {
  1, 3, 5, 6, 7
};

int countTonesSend = 511;
int countTonesRecv = 0;
*/
